---
date: 2024/08/31 14:18:31 
config: {
    top: false,
    dir: true,
    dirTag: [h1,h2,h3],
    tag: ['浏览器原理'],
    valine: true,
}
title: 浏览器从输入url到呈现页面发生的过程----目前的理解（发散自己的思维）
---

## 总述
为什么要总结出这道题呢，因为理解这道题，可以很好地构建出自己的前端知识体系，我们前端主要的工作就是编写页面然后呈现到浏览器上供用户使用，那么，理解好浏览器的原理，梳理出整个渲染的流程的话，就构成了自己前端的知识体系。就好比知道了整个流程后，就可以知道哪个流程可以更好的做性能优化，提升用户的体验；从用户输入url，到后端请求资源的时候使用的是网络请求；前端是通过webpack这种构建工具，将react,vue这种框架代码打包成浏览器能理解的代码；浏览器又是在自己内核的js引擎边解释边执行js代码；最后再渲染html，css，js到页面上。可以大概构建出流程化重要的点作为自己前端"知识树的枝干"，再慢慢拓展出自己的一些细节“树叶”。没有牢固的知识体系是无法再往高处走的。以上是我自己的一些理解，现在就开始解析整个浏览器流程吧，都是自己的理解，有误请指正。

## 简单了解下浏览器
市面上的浏览器有谷歌，edge等，用于渲染展示资源内容。浏览器是多进程的，每个进程又有独立运行的线程，那么这有个问题，什么是进程线程。进程是操作系统分配资源的最小单位，也就是说进程是操作系统分配内存的最小单位，而线程是操作系统可调度的最小单位。举个例子，进程就是一列火车，线程就是火车中的节节车厢，每节车厢是人员是可进行走动的，也就是说线程之间是可以资源共享的，但是火车之间各自行驶，是不能资源共享的;每个进程下面可以有很多独立线程去调度工作，线程之间是可以共享内存并且通信的；进程之间是不会相互影响的，但是一个线程崩掉就会导致整个进程崩掉；进程可以给内存地址上锁，也就是线程访问这个地址的时候，其他线程是访问不了的----互斥锁；进程可以限制内存地址的使用量-----信号量。

### 那么为啥浏览器要用多进程架构呢?
之前的单进程不行吗？原因就是多进程比但进程更加稳定安全，进程之间互不影响，一个进程崩掉了不会影响其进程；而如果是单进程的话，一个线程的崩掉会导致整个进程崩掉，进而导致浏览器的卡死。

### 那么浏览器中又有哪些进程线程呢?
新开一个tab页就会新开一个进程，有时候会优化，多个空白tab页会合并成一个进程。<br/>
浏览器主进程：主要负责进程的管理，页面的渲染任务，进程之间的通信，只有一个主进程<br/>
插件进程：运行插件的时候就会新开一个浏览器插件进程<br/>
GPU进程：主要负责页面的3d渲染，最多一个<br/>
渲染进程：也就是平时说的浏览器内核，主要负责页面的解析渲染，后面将渲染结果交给浏览器主进程去渲染<br/>

#### 渲染进程下的线程
GUI线程：主要负责html,css的解析<br/>
js引擎线程：主要负责js代码的解析工作，谷歌浏览器的js引擎是v8引擎；而且js‘引擎是单线程的，一条任务执行下去；并且与渲染进程是互斥的。因为如果渲染进程跟js线程可以并存的话，会带来不可预期的结果，就例如说渲染的时候要求这个dom的值+1，再js引擎又要这个dom-1，那这个时候是要加1还是减1呢，为了避免这种情况就设计成js单线程并且与渲染线程互斥。js如果执行时间过长的话，则会阻塞渲染任务的执行<br/>
事件触发线程：主要负责浏览器的事件循环触发<br/>
定时器线程：主要是执行setTimeout或者setInterval这种定时任务。为什么单开一个线程呢，因为js是单线程，跟渲染进程是互斥的，阻塞的时候会导致定时时间不准，故定时器是单独出来的一个线程。<br/>
网络线程：有网络请求的时候就会 新开一个网络线程。

### 那么进程间是如何进行通信的呢
每个渲染进程都会有一个全局的RenderProcess对象，浏览器主进程会对每个渲染进程维护一个RenderProcessHost对象，他们之间是通过chrome的ipc系统进行通信的。<br/>
每个渲染进程又有会RenderView对应渲染视图，浏览器主进程又会维护一个全局对象RenderViewHost对应渲染进程中的视图，视图会有一个唯一的id标识出视图的唯一性。渲染进程中的RenderView知道如何与主进程中的RenderViewHost进行通信，这就是进程之间的通信机制了。

## 回到主体步骤，开一个网络线程去请求后端接口资源
一般来说，异步网络请求浏览器都会新开一个新的网络线程去处理；但是如果网络请求过多的话，也不是每次都是新开线程，为了性能着想，会复用线程池里的线程，同事会限制同一域名下的tcp连接数。

### 发起网络线程后
经过因特网五层协议<br/>
应用层：dns解析，生成ip地址。一般来说url是域名的话，需要域名解析系统解析成对应的ip地址，这个过程会先去看浏览器上有没有缓存，有的话直接用浏览器这个域名解析的缓存；没有的话就去域名解析系统的根服务器上找；再没有就去权威服务器上找。这个解析的过程是很耗费时间的，所以可以使用域名提前解析，也就是在浏览器空闲的时候提前去解析域名，后面用的话就可以直接使用解析后的ip地址了<br/>
传输层：也就是tcp/ip三次握手，四次挥手的地方<br/>
网络层：用于ip寻址的地方<br/>
数据链路层：将数据封装成帧<br/>
物理层：将帧转换为电或者信号等等，通过介质传输出去<br/>
客户端就是像这样从上到下封装成信号传输给服务端，服务端收到数据则进行相反的解析<br/>




